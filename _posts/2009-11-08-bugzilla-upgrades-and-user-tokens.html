---
layout: post
title: bugzilla upgrades and user tokens
date: '2009-11-08T18:12:00.006Z'
author: Tim Abell
tags:
- mysql
- bugzilla
- troubleshooting
- sys admin
modified_time: '2009-11-10T22:28:00.731Z'
blogger_id: tag:blogger.com,1999:blog-5082828566240519947.post-1315274421552207269
blogger_orig_url: https://timwise.blogspot.com/2009/11/bugzilla-upgrades-and-user-tokens.html
---

It's bugzilla upgrade time for my private install, and I have for the second time run into a strange issue with the tokens system. Since this is the second time and I know how to fix it, here it is for the record.<br /><br />I have upgrade from v3.0.4 to 3.4.3.<br /><br />Once the site was up again, saving the site parameters (editparams.cgi) showed a big red warning:<br /><br /><blockquote><div id="bugzilla-body">    <div class="throw_error">     It looks like you didn't come from the right page (you have no valid token for     the <em>edit_parameters</em> action while processing the     'editparams.cgi' script). The reason could be one of:<br /><ul><li>You clicked the "Back" button of your web browser after having successfully       submitted changes, which is generally not a good idea (but harmless).</li><li>You entered the URL in the address bar of your web browser directly,       which should be safe.</li><li>You clicked on a URL which redirected you here <b>without your consent</b>,       in which case this action is much more critical.</li></ul>     Are you sure you want to commit these changes anyway? This may result in     unexpected and undesired results.<br /><br />[Confirm Changes]<br /></div>  <p>Or throw away these changes and go back to editparams.cgi.</p><p><br /></p> </div></blockquote><br />Pushing the button doesn't work (same page shows again).<br /><br />After much digging last time I discovered that the tokens it refers to are stored in table bugs.tokens, and that the size of the field is wrong in my installation after the upgrade (again).<br /><code><br />mysql> use bugs;<br />mysql> describe tokens;<br />+-----------+--------------+------+-----+---------+-------+<br />| Field     | Type         | Null | Key | Default | Extra |<br />+-----------+--------------+------+-----+---------+-------+<br />| userid    | mediumint(9) | YES  | MUL | NULL    |       |<br />| issuedate | datetime     | NO   |     | NULL    |       |<br />| <span style="font-weight: bold;">token     | varchar(5)</span>   | NO   | PRI | NULL    |       |<br />| tokentype | varchar(8)   | YES  |     | NULL    |       |<br />| eventdata | tinytext     | YES  |     | NULL    |       |<br />+-----------+--------------+------+-----+---------+-------+<br />5 rows in set (0.02 sec)<br /></code><br />According to the published schema, token should be varchar(16). <a href="http://www.ravenbrook.com/project/p4dti/tool/cgi/bugzilla-schema/index.cgi?action=single&amp;version=3.4.2&amp;view=View+schema#table-tokens">http://www.ravenbrook.com/project/p4dti/tool/cgi/bugzilla-schema/index.cgi?action=single&amp;version=3.4.2&amp;view=View+schema#table-tokens</a><br /><br />To fix the problem I modified the data type as follows:<br /><br /><code><br />mysql> alter table tokens modify column token varchar(16) not null;<br />Query OK, 20 rows affected (0.32 sec)<br />Records: 20  Duplicates: 0  Warnings: 0<br /></code><br /><br />And then I was able to change my parameters.<br /><br /><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=527780">https://bugzilla.mozilla.org/show_bug.cgi?id=527780</a>