---
layout: post
title: Building a Windows 10 Development VM from scratch
date: 2018-04-01 20:10:54.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  _wpcom_is_markdown: '1'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '16358806910'
  timeline_notification: '1522609856'
  _oembed_4db44b404e131563425b1197a3d06c34: "{{unknown}}"
  _oembed_4aa915bb36249a512e49bcb5d54dce02: "{{unknown}}"
  _oembed_bc831de2241915429b3bfbecfe4b37bc: "{{unknown}}"
  _oembed_5a930ac517abbaebbde0830cf2e83787: "{{unknown}}"
  _oembed_a8e5815996318124ae68503f69e67b1e: "{{unknown}}"
  _oembed_0b0df661efbe609e2e7fd327b0bc5c5b: "{{unknown}}"
  _oembed_59be78178701167b03695bd3d164b214: <a href="https://www.flickr.com/photos/tim_abell/38944561440/"><img
    src="https://farm5.staticflickr.com/4798/38944561440_829d76ac80_z.jpg" alt="IMG_20171102_170234"
    width="640" height="480" /></a>
  _oembed_time_59be78178701167b03695bd3d164b214: '1542531968'
author:
  login: timabell
  email: tim@timwise.co.uk
  display_name: timabell
  first_name: ''
  last_name: ''
permalink: "/2018/04/01/building-a-windows-10-development-vm-from-scratch/"
---
<p>&nbsp;</p>
<p class="mentions-texteditor__content">Rebuilding windows dev VM from scratch, reminds me why people put up an old build for so long. What a painful process!</p>
<p>I did wonder if I could get away with mssql on linux, and tried the <a href="https://github.com/Microsoft/mssql-docker/issues/284" target="_blank" rel="noopener">mssql docker image, which hosed my linux kernel</a>. That's too many yaks for one morning.</p>
<h2>Windows Install</h2>
<p>Download from https://www.microsoft.com/en-us/software-download/windows10ISO</p>
<ul>
<li>Windows 10 Fall Creators Update</li>
<li>English</li>
<li>64-bit</li>
</ul>
<p>Start a new VM with the iso. Run the install. Install hangs on windows logo. Hard reset, try again several times. Eventually it works. Even managed to crash my host entirely.</p>
<p>Shut down the VM with clean windows install.</p>
<p>Take a backup</p>
<p>[code lang=text]<br />
# backing up a vm<br />
cd VirtualBox\ VMs/<br />
base=.<br />
src=win10-2018<br />
ls -lh $src<br />
du -sh $src<br />
df -h .<br />
tar -cpC $base $src -P | pv -s $(du -sb $base/$src | awk &#039;{print $1}&#039;) | lz4 &gt;&gt; $src.tar.lz4<br />
# 8.79GiB 0:00:43 [ 205MiB/s] [=====================================================================&gt; ] 99%<br />
[/code]</p>
<p><a href="https://gist.github.com/timabell/68d112d66623d9a4a3643c86a93debee#file-backup-sh-L21" target="_blank" rel="noopener">Gist for backing up with lz4</a></p>
<h2>Updates! Updates! Updates!</h2>
<p>(as Ballmer once said?)</p>
<ul>
<li>poke <strong>windows updates</strong> until it finally decides there's no more</li>
<li>reboot</li>
<li>poke windows updates until it finally decides there's no more</li>
<li>reboot</li>
<li>poke windows updates until it finally decides there's no more</li>
<li>reboot</li>
<li>Install <strong>virtualbox guest additions 5.1.34</strong></li>
<li>reboot</li>
<li>shutdown</li>
<li>backup again</li>
</ul>
<p>https://www.flickr.com/photos/tim_abell/38944561440/</p>
<h2>The Snapshot Trials</h2>
<p><a href="https://www.howtogeek.com/150258/how-to-save-time-by-using-snapshots-in-virtualbox/" target="_blank" rel="noopener">VirtualBox has a neat snapshot feature</a>, so you can try out a whole tree of attempts at installs then squash them into the final image or roll them back.</p>
<p>Take a snapshot as a starting point for trying out the eternally broken boxstarter script.</p>
<h2>Boxstarter</h2>
<p><a href="https://gist.github.com/timabell/608fb680bfc920f372ac" target="_blank" rel="noopener">Boxstarter script, mostly working in win 10</a> now, but so much more to do on top that, including <a href="https://github.com/timabell/dotmatrix/tree/windows" target="_blank" rel="noopener">windows branch of dotfiles</a> (always needs work). Read the script to see what it configures and installs.</p>
<p>You'll want to watch this vid at at least 2x playback speed:</p>
<p>https://youtu.be/Hiz9_i67B3o</p>
<h2>annoyances / setup - grab reg keys</h2>
<ul>
<li>disable screensaver</li>
<li>hide task manager when minimized
<ul>
<li>HKCU\Software\Microsoft\Windows\CurrentVersion\TaskManager\Preferences - binary. sigh.settings &gt; m</li>
</ul>
</li>
<li>multitasking &gt; snap (these have been rolled in to my boxstarter, but not tested there).
<ul>
<li>HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\SnapAssist - 0<br />
HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\JointResize - 0</li>
</ul>
</li>
<li>all sounds off - generates 100s of reg keys, one for each event</li>
<li>mute</li>
</ul>
<h2>get ready for dev</h2>
<ul>
<li>vs sign-in</li>
<li>extension updates
<ul>
<li>ssdt - external download popup, installs sql server 2016 localdb, takes forever, requires reboot</li>
<li>azure - leave for now, also external</li>
</ul>
</li>
<li>jetbrains toolbox (sign in)
<ul>
<li>resharper</li>
<li>datagrip</li>
</ul>
</li>
</ul>
<h2>VS Extensions</h2>
<p><code>cinst editorconfig.vs vsvim ihateregions -y # bit-rotten, didn't work</code> I should contact the <a href="https://chocolatey.org/packages/vsvim" target="_blank" rel="noopener">VsVim package maintainer</a>. Oh never mind that would be me then.</p>
<p>Extensions to install manually:</p>
<ul>
<li>https://marketplace.visualstudio.com/items?itemName=JaredParMSFT.VsVim</li>
<li>https://marketplace.visualstudio.com/items?itemName=ZoltanKlinger.RelativeLineNumbers</li>
<li>https://marketplace.visualstudio.com/items?itemName=MadsKristensen.MarkdownEditor</li>
<li>https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.VisualStudio2015ColorThemeEditor - to get solarized colours</li>
</ul>
<p>Something to look in to https://chocolatey.org/packages/batch-install-vsix</p>
<h2>Git setup</h2>
<p>GitExtensions defaults to the program files putty, but the chocolatey one is newer and github deprecated the comms the old one uses.</p>
<ul>
<li>https://github.com/desktop/desktop/issues/4105</li>
<li>https://blog.github.com/2018-02-23-weak-cryptographic-standards-removed/</li>
</ul>
<p>Change all the putty paths in git extensions to start with <code>C:\ProgramData\chocolatey\bin\...</code></p>
<p><img class="alignnone size-full wp-image-829" src="{{ site.baseurl }}/assets/workspace-1_193.png" alt="Workspace 1_193" width="952" height="674" /></p>
<p>https://git-extensions-documentation.readthedocs.io/en/latest/settings.html</p>
<blockquote><p>Settings that are specific to Git Extensions and apply globally will be stored in a file called <code><span class="pre">GitExtensions.settings</span></code> either in the user’s application data path or with the program. The location is dependant on the IsPortable setting in the <code><span class="pre">GitExtensions.exe.config</span></code> file that is with the program.</p></blockquote>
<p>i.e .<code>C:\Users\tim\AppData\Roaming\GitExtensions\GitExtensions</code></p>
<h3>Key Setup</h3>
<ul>
<li>Map a read-write folder to outside the VM to keep the putty keys in (this avoids regenerating the key if the VM is regenerated / rolled back, and also means keys aren't copied around with the VM image which makes them a bit easier to keep track of</li>
<li>git extensions &gt; tools &gt; putty &gt; generate</li>
<li>set passphrase</li>
<li>save pub &amp; private keys to shared folder</li>
<li>grab the public key from the generator, paste into github &amp; bitbucket website account ssh configs</li>
<li>git extensions &gt; tools &gt; putty &gt; start agent &gt; add keys</li>
</ul>
<h3>DotMatrix</h3>
<p>Start git bash from git extensions, not the start menu (to get ssh set up right).</p>
<p>[code lang=text]<br />
cd /c/repo &amp;&amp; mkdir tim &amp;&amp; cd tim<br />
git clone git@github.com:timabell/dotmatrix.git<br />
cd dotmatrix/<br />
git checkout windows<br />
bin/install<br />
git st<br />
[/code]</p>
<h2>VS Settings</h2>
<p><img class="alignnone size-full wp-image-835" src="{{ site.baseurl }}/assets/workspace-1_194.png" alt="Workspace 1_194" width="746" height="436" /></p>
<p>VS &gt; Options &gt; Environment &gt; Import/export &gt; set the path to the dotmatrix copy</p>
<h2>resharper settings</h2>
<p><img class="alignnone size-full wp-image-837" src="{{ site.baseurl }}/assets/workspace-1_195.png" alt="Workspace 1_195" width="738" height="489" /></p>
<p>VS &gt; Resharper &gt; manage options &gt; right-click the gap &gt; add layer &gt; open settings file &gt; select the one from the dotmatrix</p>
<h2>More settings</h2>
<ul>
<li>VsVim settings</li>
<li>git config</li>
<li>email/name</li>
</ul>
<h2>More installs</h2>
<p>redgate tools</p>
<ul>
<li>dev bundle:
<ul>
<li>sql prompt - for VS too</li>
<li>compare</li>
<li>data compare</li>
<li>doc</li>
</ul>
</li>
<li>toolbelt bundle
<ul>
<li>readyroll</li>
</ul>
</li>
</ul>
<h2>firefox</h2>
<ul>
<li>sign-in</li>
<li>ghostery settings - disable annoying purple dot</li>
</ul>
<p class="mentions-texteditor__content">
